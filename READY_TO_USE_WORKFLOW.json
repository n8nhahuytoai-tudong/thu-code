{
  "name": "Video Scene Production Pipeline - Ready to Use",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "documentId": {
          "__rl": true,
          "value": "YOUR_GOOGLE_SHEET_ID_HERE",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTrigger",
      "typeVersion": 1,
      "position": [240, 300],
      "id": "google-sheets-trigger",
      "name": "1. Google Sheets Monitor",
      "notes": "Theo d√µi Google Sheets m·ªói ph√∫t\nKhi c√≥ row m·ªõi v·ªõi status='Ready' s·∫Ω trigger workflow"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "status-ready-check",
              "leftValue": "={{ $json.status }}",
              "rightValue": "Ready",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [460, 300],
      "id": "filter-ready-status",
      "name": "2. Filter Status Ready",
      "notes": "Ch·ªâ x·ª≠ l√Ω scenes c√≥ status = 'Ready'"
    },
    {
      "parameters": {
        "jsCode": "// Parse scenes JSON t·ª´ Google Sheets\nconst scenesString = $input.item.json.scenes || '{}';\nconst scenesData = JSON.parse(scenesString);\n\nreturn {\n  id: $input.item.json.id,\n  scenes: scenesData,\n  originalRow: $input.item.json\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [680, 300],
      "id": "parse-scenes-json",
      "name": "3. Parse Scenes JSON",
      "notes": "ƒê·ªçc v√† parse JSON scenes t·ª´ Google Sheets column"
    },
    {
      "parameters": {
        "jsCode": "// CHARACTER CONSISTENCY + VFX + EFFECTS\n// T√≠ch h·ª£p t·∫•t c·∫£ enhancement v√†o 1 node\n\n// ========================================\n// CHARACTER PROFILES - LOCKED SPECS\n// ========================================\nconst characterProfiles = {\n  'T-Rex': {\n    name: 'Rex',\n    colors: {\n      skin: '#2D4A3E',\n      eyes: '#FFB000',\n      teeth: '#FFFFF0'\n    },\n    details: [\n      'da xanh r√™u s·∫ßn s√πi (#2D4A3E)',\n      'm·∫Øt v√†ng h·ªï ph√°ch (#FFB000) v·ªõi ƒë·ªìng t·ª≠ d·ªçc',\n      'rƒÉng nanh tr·∫Øng ng√† (#FFFFF0), 58 rƒÉng',\n      'c∆° b·∫Øp cu·ªìn cu·ªôn, 3 m√≥ng vu·ªët m·ªói ch√¢n sau',\n      '32 ƒëƒ©a x∆∞∆°ng s·∫ßn s√πi d·ªçc l∆∞ng'\n    ],\n    size: '4.5m cao, 12m d√†i, 8 t·∫•n',\n    aiPrompt: 'Photo-realistic Tyrannosaurus Rex: deep forest green skin (#2D4A3E), amber yellow eyes (#FFB000), 58 ivory white teeth (#FFFFF0), 4.5m tall, 12m long, hexagonal scales, 32 dorsal plates, massive powerful build, 8K IMAX quality'\n  },\n  'Pteranodon': {\n    name: 'Terror',\n    colors: {\n      body: '#5A6B6E',\n      wings: '#8FA5A8',\n      beak: '#D86F2A',\n      eyes: '#A52A52'\n    },\n    details: [\n      's·∫£i c√°nh 7m, m√†u x√°m xanh (#8FA5A8)',\n      'c√°nh trong su·ªët 40%, c√≥ th·ªÉ nh√¨n th·∫•y g√¢n',\n      'm·ªè d√†i nh·ªçn m√†u cam (#D86F2A), kh√¥ng c√≥ rƒÉng',\n      'm√†o ƒë·∫ßu ƒë·ªè s·∫´m (#8B2835)',\n      'm·∫Øt t√≠m ƒë·ªè (#A52A52) s·∫Øc b√©n'\n    ],\n    size: 's·∫£i c√°nh 7m, n·∫∑ng 25kg',\n    aiPrompt: 'Photo-realistic Pteranodon: 7m wingspan, translucent blue-gray wings (#8FA5A8) 40% see-through with visible veins, orange beak (#D86F2A), crimson crest (#8B2835), purple-red eyes (#A52A52), fuzzy body, 8K quality'\n  }\n};\n\n// ========================================\n// VFX LIBRARY\n// ========================================\nconst vfxLibrary = {\n  dust_cloud: 'ƒë√°m b·ª•i bay d√†y (#6B5D4F)',\n  tree_shake: 'c√¢y rung, l√° r·ª•ng',\n  ground_crack: 'ƒë·∫•t n·ª©t, s·ªèi bay',\n  impact_flash: 'tia s√°ng tr·∫Øng khi va ch·∫°m',\n  motion_blur: 'm·ªù chuy·ªÉn ƒë·ªông',\n  lens_flare: 'ch·ªõp s√°ng m·∫∑t tr·ªùi',\n  debris: 'm·∫£nh v·ª° bay'\n};\n\n// ========================================\n// SMOKE/FIRE EFFECTS\n// ========================================\nconst smokeFireEffects = {\n  dust_impact: 'b·ª•i bay t·ª´ ch√¢n ƒë·∫°p xu·ªëng',\n  breathing_mist: 'h∆°i th·ªü t·∫°o s∆∞∆°ng m√π',\n  battle_dust: 'kh√≥i b·ª•i chi·∫øn ƒë·∫•u',\n  fire_sparks: 'tia l·ª≠a va ch·∫°m',\n  heat_wave: 's√≥ng nhi·ªát',\n  impact_explosion: 'v·ª• n·ªï b·ª•i nh·ªè'\n};\n\n// ========================================\n// PROCESSING FUNCTION\n// ========================================\nfunction processScene(scene, sceneNumber) {\n  let enhanced = scene;\n  const lower = scene.toLowerCase();\n  \n  // 1. CHARACTER CONSISTENCY\n  const charDetails = [];\n  \n  if (lower.includes('t-rex') || lower.includes('kh·ªßng long')) {\n    const idx = sceneNumber % characterProfiles['T-Rex'].details.length;\n    charDetails.push(characterProfiles['T-Rex'].details[idx]);\n  }\n  \n  if (lower.includes('pteranodon') || lower.includes('bay')) {\n    const idx = sceneNumber % characterProfiles['Pteranodon'].details.length;\n    charDetails.push(characterProfiles['Pteranodon'].details[idx]);\n  }\n  \n  if (charDetails.length > 0) {\n    enhanced += ` [Nh√¢n v·∫≠t: ${charDetails.join('; ')}]`;\n  }\n  \n  // 2. VFX ENHANCEMENT\n  const vfxToAdd = [];\n  \n  if (lower.match(/ch·∫°y|tr·ªën|di chuy·ªÉn/)) {\n    vfxToAdd.push(vfxLibrary.dust_cloud);\n    vfxToAdd.push(vfxLibrary.motion_blur);\n  }\n  if (lower.match(/nh·∫£y|tr√°nh|vung/)) {\n    vfxToAdd.push(vfxLibrary.ground_crack);\n    vfxToAdd.push(vfxLibrary.debris);\n  }\n  if (lower.match(/va ch·∫°m|ƒë√°nh|t·∫•n c√¥ng/)) {\n    vfxToAdd.push(vfxLibrary.impact_flash);\n  }\n  if (lower.includes('r·ª´ng') || lower.includes('c√¢y')) {\n    vfxToAdd.push(vfxLibrary.tree_shake);\n  }\n  if (lower.match(/s√°ng|tr·ªùi/)) {\n    vfxToAdd.push(vfxLibrary.lens_flare);\n  }\n  \n  if (vfxToAdd.length > 0) {\n    enhanced += ` [VFX: ${vfxToAdd.join('; ')}]`;\n  }\n  \n  // 3. SMOKE/FIRE EFFECTS\n  const sfxToAdd = [];\n  \n  if (lower.match(/ch√¢n|b∆∞·ªõc|ƒë·∫°p/)) {\n    sfxToAdd.push(smokeFireEffects.dust_impact);\n  }\n  if (lower.match(/g·∫ßm|tru|h√†m/)) {\n    sfxToAdd.push(smokeFireEffects.breathing_mist);\n  }\n  if (lower.match(/va ch·∫°m|ƒë·ª•ng|ƒë√°nh/)) {\n    sfxToAdd.push(smokeFireEffects.fire_sparks);\n    sfxToAdd.push(smokeFireEffects.impact_explosion);\n  }\n  if (lower.match(/chi·∫øn|ƒë·∫•u/)) {\n    sfxToAdd.push(smokeFireEffects.battle_dust);\n  }\n  \n  if (sfxToAdd.length > 0) {\n    enhanced += ` [Effects: ${sfxToAdd.join('; ')}]`;\n  }\n  \n  // 4. CAMERA & LIGHTING HINTS\n  let cameraHint = '';\n  if (lower.includes('c·∫≠n c·∫£nh')) {\n    cameraHint = '[Camera: Close-up 85mm, shallow DOF]';\n  } else if (lower.match(/to√†n c·∫£nh|r·ªông/)) {\n    cameraHint = '[Camera: Wide 24mm, deep focus]';\n  } else {\n    cameraHint = '[Camera: Medium 50mm]';\n  }\n  \n  enhanced += ` ${cameraHint}`;\n  \n  // 5. LIGHTING\n  let lightingHint = '[Lighting: Natural daylight, rim backlight]';\n  if (lower.match(/t·ªëi|b√≠ ·∫©n/)) {\n    lightingHint = '[Lighting: Low key, mysterious]';\n  } else if (lower.match(/s√°ng|tr·ªùi/)) {\n    lightingHint = '[Lighting: Bright sky, sun backlight]';\n  }\n  \n  enhanced += ` ${lightingHint}`;\n  \n  return enhanced;\n}\n\n// ========================================\n// ANALYZE SCENE\n// ========================================\nfunction analyzeScene(scene) {\n  const lower = scene.toLowerCase();\n  \n  return {\n    characters: [\n      ...(lower.match(/t-rex|kh·ªßng long/) ? ['T-Rex'] : []),\n      ...(lower.match(/pteranodon|bay/) ? ['Pteranodon'] : [])\n    ],\n    actionType: lower.match(/ch·∫°y|tr·ªën/) ? 'Chase' :\n                lower.match(/chi·∫øn|ƒë·∫•u|t·∫•n c√¥ng/) ? 'Combat' :\n                lower.includes('c·∫≠n c·∫£nh') ? 'Close-up' :\n                lower.match(/to√†n c·∫£nh|r·ªông/) ? 'Wide shot' : 'Transition',\n    mood: lower.match(/b√≠ ·∫©n|t·ªëi/) ? 'Mysterious' :\n          lower.match(/k·ªãch t√≠nh|ƒëe d·ªça/) ? 'Intense' :\n          lower.match(/ho·∫£ng|lo s·ª£/) ? 'Fearful' : 'Action'\n  };\n}\n\n// ========================================\n// MAIN PROCESSING\n// ========================================\nconst shots = $input.item.json.scenes.shots || [];\nconst processedShots = [];\n\nshots.forEach((shot, idx) => {\n  const sceneNumber = idx + 1;\n  const enhanced = processScene(shot.scene, sceneNumber);\n  const analysis = analyzeScene(shot.scene);\n  \n  // Create AI-ready prompt\n  let aiPrompt = enhanced;\n  \n  // Add character base prompts if characters present\n  if (analysis.characters.includes('T-Rex')) {\n    aiPrompt = characterProfiles['T-Rex'].aiPrompt + '. ' + aiPrompt;\n  }\n  if (analysis.characters.includes('Pteranodon')) {\n    aiPrompt = characterProfiles['Pteranodon'].aiPrompt + '. ' + aiPrompt;\n  }\n  \n  // Add technical specs\n  aiPrompt += `. Duration: ${shot.duration}s. Cinematic, photorealistic, 8K IMAX quality.`;\n  \n  processedShots.push({\n    scene_number: sceneNumber,\n    original: shot.scene,\n    enhanced: enhanced,\n    ai_prompt: aiPrompt,\n    duration: shot.duration,\n    analysis: analysis\n  });\n});\n\nreturn {\n  id: $input.item.json.id,\n  total_scenes: processedShots.length,\n  processed_shots: processedShots,\n  metadata: {\n    processing_date: new Date().toISOString(),\n    pipeline_version: '2.0',\n    enhancements: ['Character Consistency', 'VFX', 'Smoke/Fire', 'Camera', 'Lighting']\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 300],
      "id": "process-enhancement",
      "name": "4. Character + VFX + Effects",
      "notes": "Th√™m:\n- Character consistency (colors, details)\n- VFX effects (dust, motion blur, etc)\n- Smoke/Fire effects\n- Camera hints\n- Lighting setup\n- AI-ready prompts"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "={{ $node['1. Google Sheets Monitor'].parameter.documentId }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $node['1. Google Sheets Monitor'].parameter.sheetName }}",
          "mode": "id"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "status": "Processing"
          }
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [1120, 180],
      "id": "update-status-processing",
      "name": "5a. Update Status: Processing",
      "notes": "ƒê√°nh d·∫•u status = Processing trong Google Sheets"
    },
    {
      "parameters": {
        "mode": "chooseBranch",
        "output": "={{ $json.processed_shots.length > 0 ? 'hasScenes' : 'noScenes' }}"
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [1120, 300],
      "id": "check-has-scenes",
      "name": "5b. Check Has Scenes",
      "notes": "Ki·ªÉm tra c√≥ scenes ƒë·ªÉ x·ª≠ l√Ω kh√¥ng"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "create-output",
              "name": "output_json",
              "value": "={{ JSON.stringify($json, null, 2) }}",
              "type": "string"
            },
            {
              "id": "create-summary",
              "name": "summary",
              "value": "=Processed {{ $json.total_scenes }} scenes with full enhancements (Character Consistency + VFX + Effects + Camera + Lighting). Ready for AI video generation!",
              "type": "string"
            },
            {
              "id": "first-scene-preview",
              "name": "first_scene_example",
              "value": "={{ $json.processed_shots[0].ai_prompt }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [1340, 300],
      "id": "prepare-output",
      "name": "6. Prepare Output",
      "notes": "Chu·∫©n b·ªã output:\n- JSON ƒë·∫ßy ƒë·ªß\n- Summary\n- Preview scene ƒë·∫ßu ti√™n"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "={{ $node['1. Google Sheets Monitor'].parameter.documentId }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $node['1. Google Sheets Monitor'].parameter.sheetName }}",
          "mode": "id"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "status": "Complete",
            "processed_json": "={{ $json.output_json }}",
            "summary": "={{ $json.summary }}"
          }
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [1560, 300],
      "id": "update-complete",
      "name": "7. Update Status: Complete",
      "notes": "C·∫≠p nh·∫≠t:\n- Status = Complete\n- L∆∞u processed JSON\n- L∆∞u summary"
    },
    {
      "parameters": {
        "content": "## üé¨ VIDEO SCENE PRODUCTION PIPELINE\n\n### Workflow n√†y l√†m g√¨?\n\n1. **Monitor Google Sheets** - Theo d√µi m·ªói ph√∫t\n2. **Filter Status Ready** - Ch·ªâ x·ª≠ l√Ω row c√≥ status='Ready'\n3. **Parse Scenes** - ƒê·ªçc JSON t·ª´ Google Sheets\n4. **Enhancement** - Th√™m:\n   - ‚úÖ Character Consistency (colors, details locked)\n   - ‚úÖ VFX Effects (dust, motion blur, etc)\n   - ‚úÖ Smoke/Fire Effects\n   - ‚úÖ Camera Specs (lens, angle)\n   - ‚úÖ Lighting Setup\n   - ‚úÖ AI-Ready Prompts (cho Sora/Veo)\n5. **Update Status** - Processing ‚Üí Complete\n6. **Save Results** - L∆∞u v√†o Google Sheets\n\n### Setup:\n\n1. **Google Sheets Format:**\n   Columns c·∫ßn c√≥:\n   - `id` - unique ID\n   - `scenes` - JSON: {\"shots\": [{\"scene\": \"...\", \"duration\": 8}]}\n   - `status` - Set \"Ready\" ƒë·ªÉ trigger\n   - `processed_json` - Output (t·ª± ƒë·ªông fill)\n   - `summary` - T√≥m t·∫Øt (t·ª± ƒë·ªông fill)\n\n2. **Credentials c·∫ßn setup:**\n   - Google Sheets OAuth2\n\n3. **Edit Node 1:**\n   - Thay `YOUR_GOOGLE_SHEET_ID_HERE` b·∫±ng Sheet ID c·ªßa b·∫°n\n   - Sheet ID l·∫•y t·ª´ URL: docs.google.com/spreadsheets/d/**[SHEET_ID]**/edit\n\n### Character Specs (Locked):\n\n**T-Rex:**\n- Skin: #2D4A3E forest green\n- Eyes: #FFB000 amber yellow\n- Teeth: #FFFFF0 ivory white\n- Size: 4.5m tall, 12m long, 8 tons\n\n**Pteranodon:**\n- Wingspan: 7.0m\n- Wings: #8FA5A8 blue-gray, 40% translucent\n- Beak: #D86F2A orange\n- Eyes: #A52A52 purple-red\n\n### Test:\n\n1. Th√™m row v√†o Google Sheets:\n   ```\n   id: test_001\n   scenes: {\"shots\":[{\"scene\":\"T-Rex b∆∞·ªõc ƒëi trong r·ª´ng\",\"duration\":8}]}\n   status: Ready\n   ```\n\n2. Wait 1 minute (ho·∫∑c click Execute Workflow)\n\n3. Check Google Sheets:\n   - status ‚Üí Complete\n   - processed_json ‚Üí Full enhanced data\n   - summary ‚Üí Processing summary\n\n### Output Example:\n\nEnhanced scene s·∫Ω c√≥ d·∫°ng:\n```\nPhoto-realistic T-Rex: deep forest green skin (#2D4A3E),\namber eyes (#FFB000), ivory teeth (#FFFFF0)... T-Rex b∆∞·ªõc\nƒëi trong r·ª´ng [Nh√¢n v·∫≠t: rƒÉng nanh tr·∫Øng ng√†] [VFX: c√¢y\nrung, l√° r·ª•ng] [Effects: b·ª•i bay t·ª´ ch√¢n] [Camera: Medium\n50mm] [Lighting: Natural daylight]. Duration: 8s. 8K IMAX.\n```\n\nCopy prompt n√†y v√†o Sora/Veo ƒë·ªÉ generate video!\n\n---\n**Version:** 2.0\n**Ready to use!** ‚úÖ",
        "height": 870,
        "width": 520,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [-140, 60],
      "id": "instructions-note",
      "name": "üìñ H∆Ø·ªöNG D·∫™N S·ª¨ D·ª§NG"
    }
  ],
  "connections": {
    "1. Google Sheets Monitor": {
      "main": [
        [
          {
            "node": "2. Filter Status Ready",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "2. Filter Status Ready": {
      "main": [
        [
          {
            "node": "3. Parse Scenes JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "3. Parse Scenes JSON": {
      "main": [
        [
          {
            "node": "4. Character + VFX + Effects",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "4. Character + VFX + Effects": {
      "main": [
        [
          {
            "node": "5a. Update Status: Processing",
            "type": "main",
            "index": 0
          },
          {
            "node": "5b. Check Has Scenes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "5b. Check Has Scenes": {
      "main": [
        [
          {
            "node": "6. Prepare Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "6. Prepare Output": {
      "main": [
        [
          {
            "node": "7. Update Status: Complete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-11-07T00:00:00.000Z",
  "versionId": "new-version-2.0"
}
