{
  "name": "Complete Video Production System - All-in-One",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [240, 300],
      "id": "chat-trigger",
      "name": "1. Chat Interface",
      "webhookId": "complete-video-system-chat",
      "notes": "Interface chat v·ªõi ng∆∞·ªùi d√πng\nB·∫Øt ƒë·∫ßu conversation ƒë·ªÉ t·∫°o storyboard"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=B·∫°n l√† m·ªôt ƒê·∫†O DI·ªÑN ƒêI·ªÜN ·∫¢NH HOLLYWOOD gi√†u kinh nghi·ªám, chuy√™n v·ªÅ AI video generation (Sora 2, Veo 3). Nhi·ªám v·ª• c·ªßa b·∫°n l√† gi√∫p ng∆∞·ªùi d√πng t·∫°o m·ªôt k·ªãch b·∫£n ph√¢n c·∫£nh (storyboard) CHUY√äN NGHI·ªÜP v·ªõi ƒë·∫ßy ƒë·ªß chi ti·∫øt k·ªπ thu·∫≠t.\n\n## QUY TR√åNH L√ÄM VI·ªÜC:\n\n### B∆Ø·ªöC 1: THU TH·∫¨P TH√îNG TIN C·ªêT TRUY·ªÜN\nH·ªèi t·ª± nhi√™n, s√°ng t·∫°o v·ªÅ:\n- √ù t∆∞·ªüng c·ªët truy·ªán t·ªïng th·ªÉ\n- Setting/b·ªëi c·∫£nh (ƒë·ªãa ƒëi·ªÉm, th·ªùi gian)\n- T√¢m tr·∫°ng/mood chung (h·ªìi h·ªôp? l√£ng m·∫°n? h√†nh ƒë·ªông?)\n- Gi·ªçng ƒëi·ªáu (nghi√™m t√∫c? h√†i h∆∞·ªõc? k·ªãch t√≠nh?)\n- Reference films (ng∆∞·ªùi d√πng mu·ªën gi·ªëng phim n√†o?)\n\nKhuy·∫øn kh√≠ch gi·ªØ c√¢u chuy·ªán ng·∫Øn g·ªçn: 240 gi√¢y t·ªïng (20-30 scenes x 8 gi√¢y).\n\n### B∆Ø·ªöC 2: THI·∫æT K·∫æ NH√ÇN V·∫¨T (CRITICAL!)\nN·∫æU c√≥ nh√¢n v·∫≠t, B·∫ÆT BU·ªòC h·ªèi chi ti·∫øt:\n\n**Cho M·ªñI nh√¢n v·∫≠t, h·ªèi:**\n- T√™n v√† vai tr√≤ (protagonist? antagonist?)\n- **Appearance (LOCK NGAY - R·∫§T QUAN TR·ªåNG):**\n  - M√†u s·∫Øc ch√≠nh c·ª• th·ªÉ (v√≠ d·ª•: \"forest green #2D4A3E\", kh√¥ng ch·ªâ \"xanh\")\n  - M√†u m·∫Øt c·ª• th·ªÉ (v√≠ d·ª•: \"amber yellow #FFB000\")\n  - K√≠ch th∆∞·ªõc/t·ª∑ l·ªá (cao bao nhi√™u? l·ªõn th·∫ø n√†o? so v·ªõi g√¨?)\n  - ƒê·∫∑c ƒëi·ªÉm n·ªïi b·∫≠t duy nh·∫•t (s·∫πo? v·∫£y? c√°nh? rƒÉng nanh? bao nhi√™u?)\n  - Texture/v·∫≠t li·ªáu (da? v·∫£y? l√¥ng? b√≥ng? nh√°m?)\n\n**QUAN TR·ªåNG - Nh·∫•n m·∫°nh v·ªõi user:**\n\"C√°c th√¥ng tin v·ªÅ nh√¢n v·∫≠t n√†y s·∫Ω ƒë∆∞·ª£c LOCK v√† d√πng GI·ªêNG NHAU cho T·∫§T C·∫¢ 20-30 scenes ƒë·ªÉ ƒë·∫£m b·∫£o consistency khi AI generate video. V√¨ v·∫≠y h√£y m√¥ t·∫£ C·ª§ TH·ªÇ NH·∫§T c√≥ th·ªÉ ngay t·ª´ ƒë·∫ßu!\n\nV√≠ d·ª• T·ªêT: 'T-Rex c√≥ da xanh r√™u ƒë·∫≠m (#2D4A3E) v·ªõi v·∫£y s·∫ßn s√πi, m·∫Øt v√†ng h·ªï ph√°ch (#FFB000), 58 rƒÉng nanh tr·∫Øng ng√†, cao 4.5m'\nV√≠ d·ª• X·∫§U: 'T-Rex m√†u xanh, m·∫Øt v√†ng, c√≥ rƒÉng'\"\n\n### B∆Ø·ªöC 3: PHONG C√ÅCH H√åNH ·∫¢NH\nH·ªèi v·ªÅ:\n- **Color palette** (warm/cool? vibrant/muted? hex codes n·∫øu c√≥)\n- **Lighting style** (bright daylight? dark moody? golden hour? dramatic?)\n- **Camera style** (steady cinematic? handheld shaky? smooth drone?)\n- **VFX level** (realistic? stylized? heavy effects? minimal?)\n- **Reference films** (Jurassic Park? Avatar? Mad Max? Blade Runner?)\n\n### B∆Ø·ªöC 4: X√ÇY D·ª∞NG STORYBOARD\nV·ªõi th√¥ng tin ƒë√£ c√≥, h∆∞·ªõng d·∫´n chia c√¢u chuy·ªán th√†nh:\n- 20-30 scenes (t·ªïng ~240 gi√¢y)\n- M·ªói scene 8 gi√¢y\n- C√°c \"kho·∫£nh kh·∫Øc ƒëi·ªán ·∫£nh\" r√µ r√†ng\n\nCho M·ªñI scene, bao g·ªìm:\n- H√†nh ƒë·ªông/c·∫£nh quay c·ª• th·ªÉ\n- Nh√¢n v·∫≠t n√†o xu·∫•t hi·ªán (mention m√†u s·∫Øc/ƒë·∫∑c ƒëi·ªÉm)\n- Camera angle (wide? medium? close-up? aerial? low angle?)\n- Lighting hint (bright? backlit? dark? dappled?)\n- Mood (tense? calm? action? mysterious?)\n- Effects c·∫ßn thi·∫øt (dust? smoke? rain? fire?)\n\n### B∆Ø·ªöC 5: T√ìM T·∫ÆT STORYBOARD\nFormat:\n\n### C·∫£nh 1: [T√™n ng·∫Øn g·ªçn]\n**M√¥ t·∫£:** [H√†nh ƒë·ªông chi ti·∫øt + nh√¢n v·∫≠t details + camera + lighting + mood]\n**Th·ªùi l∆∞·ª£ng:** 8 gi√¢y\n\n### C·∫£nh 2: [T√™n ng·∫Øn g·ªçn]\n**M√¥ t·∫£:** [T∆∞∆°ng t·ª±...]\n**Th·ªùi l∆∞·ª£ng:** 8 gi√¢y\n\n[...ti·∫øp t·ª•c cho t·∫•t c·∫£ scenes]\n\n---\n\n### üé® CHARACTER CONSISTENCY LOCKED SPECS:\n\n**[T√™n Nh√¢n V·∫≠t 1]:**\n- M√†u ch·ªß ƒë·∫°o: [c·ª• th·ªÉ + hex code]\n- M√†u m·∫Øt: [c·ª• th·ªÉ + hex]\n- K√≠ch th∆∞·ªõc: [s·ªë li·ªáu]\n- ƒê·∫∑c ƒëi·ªÉm: [chi ti·∫øt]\n- Texture: [m√¥ t·∫£]\n\n**[T√™n Nh√¢n V·∫≠t 2]:**\n[...t∆∞∆°ng t·ª±]\n\n‚ö†Ô∏è **C√ÅC TH√îNG S·ªê TR√äN PH·∫¢I GI·ªêNG NHAU 100% TRONG T·∫§T C·∫¢ SCENES!**\n\n---\n\n**V√ç D·ª§ SCENE M√î T·∫¢ CHU·∫®N:**\n\"T-Rex (da xanh r√™u #2D4A3E, m·∫Øt v√†ng h·ªï ph√°ch #FFB000, rƒÉng tr·∫Øng ng√†, 4.5m cao) b∆∞·ªõc ƒëi uy nghi qua r·ª´ng r·∫≠m. Camera: Low angle medium shot looking up. Lighting: Dappled morning sunlight through trees, strong rim backlight on dorsal plates. Mood: Powerful, mysterious. M·ªói b∆∞·ªõc ch√¢n t·∫°o rung ƒë·ªông ƒë·∫•t, b·ª•i n√¢u bay l√™n.\"\n\n### B∆Ø·ªöC 6: X√ÅC NH·∫¨N\nSau khi t√≥m t·∫Øt storyboard ƒë·∫ßy ƒë·ªß, h·ªèi:\n\n\"üìã Storyboard tr√™n c√≥ ·ªïn kh√¥ng? \n\nKi·ªÉm tra:\n‚úì Nh√¢n v·∫≠t c√≥ ƒë√∫ng kh√¥ng?\n‚úì M√†u s·∫Øc/ƒë·∫∑c ƒëi·ªÉm c√≥ r√µ r√†ng kh√¥ng?\n‚úì S·ªë l∆∞·ª£ng scenes ph√π h·ª£p kh√¥ng? (20-30 scenes)\n‚úì C·∫ßn ch·ªânh s·ª≠a g√¨ kh√¥ng?\n\nN·∫øu OK, t√¥i s·∫Ω l∆∞u v√†o Google Sheets ƒë·ªÉ x·ª≠ l√Ω ti·∫øp!\"\n\nƒê·ª£i user X√ÅC NH·∫¨N tr∆∞·ªõc khi ti·∫øp t·ª•c.\n\n### B∆Ø·ªöC 7: L∆ØU V√ÄO GOOGLE SHEETS\nSau khi user x√°c nh·∫≠n ·ªïn, s·ª≠ d·ª•ng Google Sheets tool ƒë·ªÉ th√™m row m·ªõi.\n\n**C·∫•u tr√∫c JSON b·∫Øt bu·ªôc:**\n```json\n{\n  \"shots\": [\n    {\n      \"scene\": \"[M√¥ t·∫£ ƒë·∫ßy ƒë·ªß bao g·ªìm: action + character details v·ªõi m√†u s·∫Øc + camera + lighting + mood + effects]\",\n      \"duration\": 8\n    },\n    {\n      \"scene\": \"[Scene 2...]\",\n      \"duration\": 8\n    }\n    // ... ti·∫øp t·ª•c cho t·∫•t c·∫£ scenes\n  ]\n}\n```\n\n**QUAN TR·ªåNG - M·ªói scene description ph·∫£i c√≥:**\n- H√†nh ƒë·ªông/c·∫£nh quay\n- Nh√¢n v·∫≠t + m√†u s·∫Øc/ƒë·∫∑c ƒëi·ªÉm (n·∫øu xu·∫•t hi·ªán)\n- Camera hint (wide/medium/close-up, angle)\n- Lighting hint (bright/dark/backlit, etc.)\n- Mood/atmosphere\n- Effects (n·∫øu c√≥)\n\n**CH·ªà ghi v√†o Google Sheets SAU KHI user x√°c nh·∫≠n ·ªïn!**\n\n---\n\n## L∆ØU √ù QUAN TR·ªåNG:\n\n‚ùå KH√îNG t·ª± t·∫°o ho·∫∑c g·ªçi b·∫•t k·ª≥ API video n√†o\n‚ùå KH√îNG t·ª± ƒë·ªông l∆∞u tr∆∞·ªõc khi x√°c nh·∫≠n\n‚úÖ Tr√°ch nhi·ªám: Thi·∫øt k·∫ø storyboard + Lock character consistency + L∆∞u Google Sheets\n‚úÖ Gi·ªçng ƒëi·ªáu: Th√¢n thi·ªán, chuy√™n nghi·ªáp, ƒë·∫°o di·ªÖn Hollywood\n‚úÖ PRIORITY #1: Character consistency - ph·∫£i lock m√†u s·∫Øc/details t·ª´ ƒë·∫ßu!\n\n---\n\n**B·∫Øt ƒë·∫ßu b·∫±ng c√¢u ch√†o th√¢n thi·ªán v√† h·ªèi v·ªÅ √Ω t∆∞·ªüng phim c·ªßa h·ªç!** üé¨"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [460, 300],
      "id": "ai-director-agent",
      "name": "2. AI Director (Hollywood)",
      "notes": "AI Agent v·ªõi prompt c·∫£i ti·∫øn:\n- H·ªèi chi ti·∫øt character consistency\n- Lock m√†u s·∫Øc/specs t·ª´ ƒë·∫ßu\n- H∆∞·ªõng d·∫´n technical details\n- Output chu·∫©n Hollywood"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [320, 480],
      "id": "openai-model",
      "name": "OpenAI GPT-4",
      "credentials": {
        "openAiApi": {
          "id": "YOUR_OPENAI_CREDENTIAL_ID",
          "name": "OpenAI Account"
        }
      },
      "notes": "GPT-4o model\nThay YOUR_OPENAI_CREDENTIAL_ID"
    },
    {
      "parameters": {
        "contextWindowLength": 12
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [460, 480],
      "id": "conversation-memory",
      "name": "Conversation Memory",
      "notes": "Nh·ªõ 12 messages cu·ªëi\n(ƒë·ªß cho conversation d√†i)"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "YOUR_GOOGLE_SHEET_ID_HERE",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $fromAI('id', 'Generate unique ID for this storyboard', 'string') }}",
            "scenes": "={{ $fromAI('scenes', 'The complete storyboard in JSON format: {\"shots\":[{\"scene\":\"...\",\"duration\":8}]}', 'string') }}",
            "status": "Ready"
          },
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "type": "string",
              "required": false
            },
            {
              "id": "scenes",
              "displayName": "scenes",
              "type": "string",
              "required": false
            },
            {
              "id": "status",
              "displayName": "status",
              "type": "string",
              "required": false
            },
            {
              "id": "task id",
              "displayName": "task id",
              "type": "string",
              "required": false
            },
            {
              "id": "processed_json",
              "displayName": "processed_json",
              "type": "string",
              "required": false
            },
            {
              "id": "summary",
              "displayName": "summary",
              "type": "string",
              "required": false
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [600, 480],
      "id": "save-to-sheets-tool",
      "name": "Save to Google Sheets",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YOUR_GOOGLE_SHEETS_CREDENTIAL_ID",
          "name": "Google Sheets Account"
        }
      },
      "notes": "Tool cho AI Agent\nL∆∞u storyboard v√†o Google Sheets\nThay YOUR_GOOGLE_SHEET_ID_HERE"
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "documentId": {
          "__rl": true,
          "value": "={{ $node['Save to Google Sheets'].parameter.documentId }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $node['Save to Google Sheets'].parameter.sheetName }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTrigger",
      "typeVersion": 1,
      "position": [980, 300],
      "id": "sheets-monitor",
      "name": "3. Monitor Google Sheets",
      "credentials": {
        "googleSheetsTriggerOAuth2Api": {
          "id": "YOUR_GOOGLE_SHEETS_CREDENTIAL_ID",
          "name": "Google Sheets Account"
        }
      },
      "notes": "Theo d√µi Google Sheets m·ªói ph√∫t\nT·ª± ƒë·ªông trigger khi c√≥ row m·ªõi"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "check-ready",
              "leftValue": "={{ $json.status }}",
              "rightValue": "Ready",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [1180, 300],
      "id": "filter-ready",
      "name": "4. Filter Status Ready",
      "notes": "Ch·ªâ x·ª≠ l√Ω scenes c√≥ status='Ready'"
    },
    {
      "parameters": {
        "jsCode": "// Parse scenes JSON t·ª´ Google Sheets\nconst scenesString = $input.item.json.scenes || '{}';\nconst scenesData = JSON.parse(scenesString);\n\nreturn {\n  id: $input.item.json.id,\n  scenes: scenesData,\n  originalRow: $input.item.json\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1380, 300],
      "id": "parse-json",
      "name": "5. Parse Scenes JSON",
      "notes": "ƒê·ªçc v√† parse JSON scenes"
    },
    {
      "parameters": {
        "jsCode": "// ==========================================\n// COMPLETE SCENE ENHANCEMENT PROCESSOR\n// Character Consistency + VFX + Effects + Camera + Lighting\n// ==========================================\n\nconst characterProfiles = {\n  'T-Rex': {\n    colors: { skin: '#2D4A3E', eyes: '#FFB000', teeth: '#FFFFF0' },\n    details: [\n      'da xanh r√™u s·∫ßn s√πi #2D4A3E',\n      'm·∫Øt v√†ng h·ªï ph√°ch #FFB000 v·ªõi ƒë·ªìng t·ª≠ d·ªçc',\n      'rƒÉng nanh tr·∫Øng ng√† #FFFFF0, 58 rƒÉng',\n      'c∆° b·∫Øp cu·ªìn cu·ªôn, 3 m√≥ng vu·ªët ƒëen m·ªói ch√¢n sau',\n      '32 ƒëƒ©a x∆∞∆°ng s·∫ßn s√πi d·ªçc l∆∞ng'\n    ],\n    aiPrompt: 'Photo-realistic Tyrannosaurus Rex: deep forest green skin (#2D4A3E), amber yellow eyes (#FFB000), 58 ivory white teeth (#FFFFF0), hexagonal scales on head, 32 dorsal plates along spine, 4.5m tall, 12m long, 8 tons, massive build'\n  },\n  'Pteranodon': {\n    colors: { body: '#5A6B6E', wings: '#8FA5A8', beak: '#D86F2A', eyes: '#A52A52' },\n    details: [\n      's·∫£i c√°nh 7m, m√†u x√°m xanh #8FA5A8, trong su·ªët 40%',\n      'g√¢n c√°nh h√¨nh c√¢y, t·ªëi m√†u, nh√¨n r√µ khi c√≥ √°nh s√°ng sau l∆∞ng',\n      'm·ªè d√†i nh·ªçn m√†u cam #D86F2A, kh√¥ng rƒÉng',\n      'm√†o ƒë·∫ßu ƒë·ªè s·∫´m #8B2835, h√¨nh l∆∞·ª°i ki·∫øm',\n      'm·∫Øt t√≠m ƒë·ªè #A52A52 v·ªõi v√≤ng v√†ng, s·∫Øc b√©n'\n    ],\n    aiPrompt: 'Photo-realistic Pteranodon: 7m wingspan, translucent blue-gray wings (#8FA5A8) 40% see-through with visible dark veins in tree-branch pattern, orange beak (#D86F2A) no teeth, dark crimson crest (#8B2835), purple-red eyes (#A52A52) with gold ring, fuzzy body, 25kg light'\n  }\n};\n\nconst vfxLibrary = {\n  dust_cloud: 'ƒë√°m b·ª•i n√¢u #6B5D4F bay d√†y',\n  tree_shake: 'c√¢y rung m·∫°nh, l√° r·ª•ng tung t√≥e',\n  ground_crack: 'ƒë·∫•t n·ª©t lan t·ªèa, s·ªèi ƒë√° b·∫≠t l√™n',\n  impact_flash: 'tia s√°ng tr·∫Øng xanh khi va ch·∫°m',\n  motion_blur: 'm·ªù chuy·ªÉn ƒë·ªông t·ªëc ƒë·ªô cao',\n  lens_flare: 'ch·ªõp s√°ng m·∫∑t tr·ªùi qua khe l√°',\n  debris: 'm·∫£nh v·ª° c√¢y c·ªëi bay trong kh√¥ng kh√≠'\n};\n\nconst smokeFireEffects = {\n  dust_impact: 'b·ª•i bay d√†y t·ª´ ch√¢n ƒë·∫°p xu·ªëng ƒë·∫•t',\n  breathing_mist: 'h∆°i th·ªü t·∫°o s∆∞∆°ng m√π nh·∫π',\n  battle_dust: 'kh√≥i b·ª•i d√†y bao tr√πm khu v·ª±c chi·∫øn ƒë·∫•u',\n  fire_sparks: 'tia l·ª≠a nh·ªè b·∫Øn t·ª´ va ch·∫°m',\n  heat_wave: 's√≥ng nhi·ªát m√©o m√≥ kh√¥ng kh√≠',\n  impact_explosion: 'v·ª• n·ªï nh·ªè b·ª•i ƒë·∫•t khi va ch·∫°m m·∫°nh'\n};\n\nfunction processScene(scene, sceneNumber) {\n  let enhanced = scene;\n  const lower = scene.toLowerCase();\n  \n  // 1. CHARACTER CONSISTENCY\n  const charDetails = [];\n  if (lower.includes('t-rex') || lower.includes('kh·ªßng long')) {\n    const idx = sceneNumber % characterProfiles['T-Rex'].details.length;\n    charDetails.push(characterProfiles['T-Rex'].details[idx]);\n  }\n  if (lower.includes('pteranodon') || lower.includes('bay')) {\n    const idx = sceneNumber % characterProfiles['Pteranodon'].details.length;\n    charDetails.push(characterProfiles['Pteranodon'].details[idx]);\n  }\n  if (charDetails.length > 0) {\n    enhanced += ` [Character: ${charDetails.join('; ')}]`;\n  }\n  \n  // 2. VFX AUTO-DETECTION\n  const vfx = [];\n  if (lower.match(/ch·∫°y|tr·ªën|di chuy·ªÉn/)) {\n    vfx.push(vfxLibrary.dust_cloud, vfxLibrary.motion_blur);\n  }\n  if (lower.match(/nh·∫£y|tr√°nh|vung/)) {\n    vfx.push(vfxLibrary.ground_crack, vfxLibrary.debris);\n  }\n  if (lower.match(/va ch·∫°m|ƒë√°nh|t·∫•n c√¥ng/)) {\n    vfx.push(vfxLibrary.impact_flash);\n  }\n  if (lower.includes('r·ª´ng') || lower.includes('c√¢y')) {\n    vfx.push(vfxLibrary.tree_shake);\n  }\n  if (lower.match(/s√°ng|tr·ªùi|√°nh/)) {\n    vfx.push(vfxLibrary.lens_flare);\n  }\n  if (vfx.length > 0) {\n    enhanced += ` [VFX: ${vfx.join('; ')}]`;\n  }\n  \n  // 3. SMOKE/FIRE EFFECTS\n  const sfx = [];\n  if (lower.match(/ch√¢n|b∆∞·ªõc|ƒë·∫°p/)) sfx.push(smokeFireEffects.dust_impact);\n  if (lower.match(/g·∫ßm|tru|h√†m/)) sfx.push(smokeFireEffects.breathing_mist);\n  if (lower.match(/va ch·∫°m|ƒë·ª•ng|ƒë√°nh/)) {\n    sfx.push(smokeFireEffects.fire_sparks, smokeFireEffects.impact_explosion);\n  }\n  if (lower.match(/chi·∫øn|ƒë·∫•u/)) sfx.push(smokeFireEffects.battle_dust);\n  if (sfx.length > 0) {\n    enhanced += ` [SFX: ${sfx.join('; ')}]`;\n  }\n  \n  // 4. CAMERA AUTO-DETECTION\n  let camera = '[Camera: Medium 50mm, eye level]';\n  if (lower.includes('c·∫≠n c·∫£nh')) {\n    camera = '[Camera: Close-up 85mm, shallow DOF f/2.8]';\n  } else if (lower.match(/to√†n c·∫£nh|r·ªông/)) {\n    camera = '[Camera: Wide 24mm, deep focus f/8]';\n  } else if (lower.match(/bay|tr√™n cao/)) {\n    camera = '[Camera: Aerial drone, wide angle]';\n  } else if (lower.match(/nh√¨n l√™n|uy nghi/)) {\n    camera = '[Camera: Low angle looking up, heroic]';\n  }\n  enhanced += ` ${camera}`;\n  \n  // 5. LIGHTING AUTO-DETECTION\n  let lighting = '[Lighting: Natural daylight, soft rim backlight]';\n  if (lower.match(/t·ªëi|b√≠ ·∫©n|ƒë√™m/)) {\n    lighting = '[Lighting: Low key, dark shadows, mysterious]';\n  } else if (lower.match(/s√°ng|tr·ªùi|m·∫∑t tr·ªùi/)) {\n    lighting = '[Lighting: Bright sky, sun backlight, lens flare]';\n  } else if (lower.match(/r·ª´ng|c√¢y|t√°n l√°/)) {\n    lighting = '[Lighting: Dappled through trees, god rays]';\n  } else if (lower.match(/chi·∫øn|ƒë·∫•u|k·ªãch t√≠nh/)) {\n    lighting = '[Lighting: Dramatic high contrast, rim light]';\n  }\n  enhanced += ` ${lighting}`;\n  \n  return enhanced;\n}\n\nfunction analyzeScene(scene) {\n  const lower = scene.toLowerCase();\n  return {\n    characters: [\n      ...(lower.match(/t-rex|kh·ªßng long/) ? ['T-Rex'] : []),\n      ...(lower.match(/pteranodon|bay/) ? ['Pteranodon'] : [])\n    ],\n    actionType: lower.match(/ch·∫°y|tr·ªën/) ? 'Chase' :\n                lower.match(/chi·∫øn|ƒë·∫•u|t·∫•n c√¥ng/) ? 'Combat' :\n                lower.includes('c·∫≠n c·∫£nh') ? 'Close-up' :\n                lower.match(/to√†n c·∫£nh|r·ªông/) ? 'Wide shot' : 'Transition',\n    mood: lower.match(/b√≠ ·∫©n|t·ªëi/) ? 'Mysterious' :\n          lower.match(/k·ªãch t√≠nh|ƒëe d·ªça/) ? 'Intense' :\n          lower.match(/ho·∫£ng|lo s·ª£/) ? 'Fearful' : 'Action',\n    cameraAngle: lower.includes('c·∫≠n c·∫£nh') ? 'Close-up' :\n                 lower.match(/to√†n c·∫£nh|r·ªông/) ? 'Wide' : 'Medium'\n  };\n}\n\n// MAIN PROCESSING\nconst shots = $input.item.json.scenes.shots || [];\nconst processedShots = [];\n\nshots.forEach((shot, idx) => {\n  const sceneNumber = idx + 1;\n  const enhanced = processScene(shot.scene, sceneNumber);\n  const analysis = analyzeScene(shot.scene);\n  \n  // Create AI-ready prompt\n  let aiPrompt = '';\n  \n  // Add character base prompts\n  if (analysis.characters.includes('T-Rex')) {\n    aiPrompt += characterProfiles['T-Rex'].aiPrompt + '. ';\n  }\n  if (analysis.characters.includes('Pteranodon')) {\n    aiPrompt += characterProfiles['Pteranodon'].aiPrompt + '. ';\n  }\n  \n  // Add enhanced scene description\n  aiPrompt += enhanced;\n  \n  // Add quality tags\n  aiPrompt += '. Cinematic, photorealistic, 8K IMAX quality, Hollywood production.';\n  \n  processedShots.push({\n    scene_number: sceneNumber,\n    original: shot.scene,\n    enhanced: enhanced,\n    ai_prompt: aiPrompt,\n    duration: shot.duration,\n    analysis: analysis\n  });\n});\n\nreturn {\n  id: $input.item.json.id,\n  total_scenes: processedShots.length,\n  processed_shots: processedShots,\n  metadata: {\n    processing_date: new Date().toISOString(),\n    pipeline_version: '3.0-complete',\n    enhancements: [\n      'Character Consistency (locked colors)',\n      'VFX Auto-detection',\n      'Smoke/Fire Effects',\n      'Camera Auto-selection',\n      'Lighting Auto-setup',\n      'AI-ready prompts'\n    ]\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1600, 300],
      "id": "enhancement-processor",
      "name": "6. Complete Enhancement",
      "notes": "X·ª≠ l√Ω T·∫§T C·∫¢:\n‚úì Character consistency\n‚úì VFX auto-detect\n‚úì Smoke/Fire effects\n‚úì Camera selection\n‚úì Lighting setup\n‚úì AI prompts"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "={{ $node['3. Monitor Google Sheets'].parameter.documentId }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $node['3. Monitor Google Sheets'].parameter.sheetName }}",
          "mode": "id"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "status": "Processing"
          }
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [1820, 180],
      "id": "update-processing",
      "name": "7a. Update: Processing",
      "notes": "ƒê√°nh d·∫•u ƒëang x·ª≠ l√Ω"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "output-json",
              "name": "output_json",
              "value": "={{ JSON.stringify($json, null, 2) }}",
              "type": "string"
            },
            {
              "id": "summary-text",
              "name": "summary",
              "value": "=‚úÖ Processed {{ $json.total_scenes }} scenes successfully!\n\nEnhancements applied:\n- Character Consistency (locked colors & specs)\n- VFX Effects ({{ $json.processed_shots.filter(s => s.enhanced.includes('[VFX:')).length }} scenes)\n- Smoke/Fire ({{ $json.processed_shots.filter(s => s.enhanced.includes('[SFX:')).length }} scenes)\n- Camera specs (all scenes)\n- Lighting setups (all scenes)\n\nüé¨ Ready for AI video generation (Sora 2 / Veo 3)!\n\nFirst scene AI prompt preview:\n{{ $json.processed_shots[0].ai_prompt.substring(0, 200) }}...",
              "type": "string"
            },
            {
              "id": "scene-count",
              "name": "scene_count",
              "value": "={{ $json.total_scenes }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [1820, 300],
      "id": "prepare-output",
      "name": "7b. Prepare Output",
      "notes": "Format output ƒë·∫πp:\n- JSON ƒë·∫ßy ƒë·ªß\n- Summary statistics\n- Preview AI prompt"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "={{ $node['3. Monitor Google Sheets'].parameter.documentId }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $node['3. Monitor Google Sheets'].parameter.sheetName }}",
          "mode": "id"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "status": "Complete",
            "processed_json": "={{ $json.output_json }}",
            "summary": "={{ $json.summary }}"
          }
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [2040, 300],
      "id": "update-complete",
      "name": "8. Update: Complete ‚úÖ",
      "notes": "C·∫≠p nh·∫≠t:\n- Status = Complete\n- L∆∞u processed JSON\n- L∆∞u summary\n\n‚Üí DONE!"
    },
    {
      "parameters": {
        "content": "## üé¨ COMPLETE VIDEO PRODUCTION SYSTEM\n### All-in-One Workflow\n\n---\n\n## üìã WORKFLOW N√ÄY L√ÄM G√å?\n\n### PART 1: AI CHAT STORYBOARD (Nodes 1-2)\n‚úÖ Chat v·ªõi AI Director Hollywood-style\n‚úÖ H·ªèi chi ti·∫øt character consistency\n‚úÖ Lock m√†u s·∫Øc/specs t·ª´ ƒë·∫ßu (hex codes!)\n‚úÖ H∆∞·ªõng d·∫´n technical details (camera, lighting)\n‚úÖ T·∫°o storyboard chu·∫©n chuy√™n nghi·ªáp\n‚úÖ L∆∞u v√†o Google Sheets\n\n### PART 2: AUTO PROCESSING (Nodes 3-8)\n‚úÖ Monitor Google Sheets (m·ªói ph√∫t)\n‚úÖ Auto-trigger khi c√≥ storyboard m·ªõi\n‚úÖ Enhance T·∫§T C·∫¢ scenes:\n   - Character consistency enforcement\n   - VFX auto-detection (dust, motion blur, etc.)\n   - Smoke/Fire effects\n   - Camera auto-selection (close/wide/aerial)\n   - Lighting auto-setup (bright/dark/dramatic)\n   - AI-ready prompts (copy v√†o Sora/Veo!)\n‚úÖ L∆∞u k·∫øt qu·∫£ v·ªÅ Google Sheets\n\n---\n\n## üöÄ SETUP - 5 B∆Ø·ªöC:\n\n### 1Ô∏è‚É£ GOOGLE SHEETS\nT·∫°o sheet v·ªõi columns:\n| id | scenes | status | task id | processed_json | summary |\n|----|--------|--------|---------|----------------|----------|\n\n### 2Ô∏è‚É£ CREDENTIALS\nSetup 2 credentials:\n- **OpenAI API** (GPT-4)\n- **Google Sheets OAuth2**\n\n### 3Ô∏è‚É£ UPDATE IDs\nThay trong workflow:\n- Node \"Save to Google Sheets\": `YOUR_GOOGLE_SHEET_ID_HERE`\n- Node \"OpenAI GPT-4\": `YOUR_OPENAI_CREDENTIAL_ID`\n- Nodes Google Sheets: `YOUR_GOOGLE_SHEETS_CREDENTIAL_ID`\n\nL·∫•y Sheet ID t·ª´ URL:\n`docs.google.com/spreadsheets/d/`**[SHEET_ID]**`/edit`\n\n### 4Ô∏è‚É£ ACTIVATE\nB·∫≠t workflow:\n- Save\n- Toggle \"Active\" switch ON\n\n### 5Ô∏è‚É£ TEST\nM·ªü chat interface v√† n√≥i:\n\"T√¥i mu·ªën l√†m video v·ªÅ T-Rex vs Pteranodon\"\n\n---\n\n## üí¨ C√ÅCH D√ôNG:\n\n### Chat v·ªõi AI Director:\n1. M·ªü Chat interface (webhook URL)\n2. AI s·∫Ω h·ªèi v·ªÅ:\n   - C·ªët truy·ªán\n   - Nh√¢n v·∫≠t (m√†u s·∫Øc, k√≠ch th∆∞·ªõc, ƒë·∫∑c ƒëi·ªÉm)\n   - Phong c√°ch h√¨nh ·∫£nh\n   - Camera & lighting preferences\n3. AI t·∫°o storyboard chi ti·∫øt\n4. B·∫°n x√°c nh·∫≠n\n5. AI l∆∞u v√†o Google Sheets\n\n### Auto Processing:\n- Workflow t·ª± ƒë·ªông ch·∫°y m·ªói ph√∫t\n- Ph√°t hi·ªán storyboard m·ªõi (status=Ready)\n- X·ª≠ l√Ω enhancement ƒë·∫ßy ƒë·ªß\n- L∆∞u k·∫øt qu·∫£ (status=Complete)\n- Check column `processed_json` ƒë·ªÉ l·∫•y AI prompts!\n\n---\n\n## üé® CHARACTER CONSISTENCY:\n\nWorkflow n√†y ƒê·∫¢M B·∫¢O nh√¢n v·∫≠t gi·ªëng nhau 100% qua t·∫•t c·∫£ scenes!\n\n**T-Rex Locked Specs:**\n- Skin: #2D4A3E forest green\n- Eyes: #FFB000 amber yellow\n- Teeth: #FFFFF0 ivory white\n- Size: 4.5m tall, 12m long\n\n**Pteranodon Locked Specs:**\n- Wings: #8FA5A8 blue-gray, 40% translucent\n- Beak: #D86F2A orange, no teeth\n- Eyes: #A52A52 purple-red\n- Wingspan: 7.0m exactly\n\n---\n\n## üì§ OUTPUT:\n\n**M·ªói scene s·∫Ω c√≥ AI prompt ƒë·∫ßy ƒë·ªß:**\n```\nPhoto-realistic T-Rex: deep forest green skin (#2D4A3E),\namber yellow eyes (#FFB000), 58 ivory white teeth...\nT-Rex b∆∞·ªõc ƒëi trong r·ª´ng [Character: rƒÉng nanh tr·∫Øng ng√†]\n[VFX: c√¢y rung, l√° r·ª•ng] [SFX: b·ª•i bay] [Camera: Medium\n50mm] [Lighting: Dappled through trees]. Cinematic, 8K IMAX.\n```\n\n‚Üí **Copy v√†o Sora 2 / Veo 3 ƒë·ªÉ generate!**\n\n---\n\n## ‚úÖ FEATURES:\n\n‚úì **Hollywood-standard workflow**\n‚úì **Character consistency 100%**\n‚úì **Auto enhancement (VFX, camera, lighting)**\n‚úì **AI-ready prompts**\n‚úì **End-to-end automation**\n‚úì **Professional storyboarding**\n\n---\n\n**Version:** 3.0 Complete\n**Ready to use!** üé¨",
        "height": 1080,
        "width": 520,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [-160, -60],
      "id": "instructions",
      "name": "üìñ H∆Ø·ªöNG D·∫™N ƒê·∫¶Y ƒê·ª¶"
    }
  ],
  "connections": {
    "1. Chat Interface": {
      "main": [
        [
          {
            "node": "2. AI Director (Hollywood)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI GPT-4": {
      "ai_languageModel": [
        [
          {
            "node": "2. AI Director (Hollywood)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Conversation Memory": {
      "ai_memory": [
        [
          {
            "node": "2. AI Director (Hollywood)",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Save to Google Sheets": {
      "ai_tool": [
        [
          {
            "node": "2. AI Director (Hollywood)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "3. Monitor Google Sheets": {
      "main": [
        [
          {
            "node": "4. Filter Status Ready",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "4. Filter Status Ready": {
      "main": [
        [
          {
            "node": "5. Parse Scenes JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "5. Parse Scenes JSON": {
      "main": [
        [
          {
            "node": "6. Complete Enhancement",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "6. Complete Enhancement": {
      "main": [
        [
          {
            "node": "7a. Update: Processing",
            "type": "main",
            "index": 0
          },
          {
            "node": "7b. Prepare Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "7b. Prepare Output": {
      "main": [
        [
          {
            "node": "8. Update: Complete ‚úÖ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 2,
  "updatedAt": "2025-11-07T00:00:00.000Z",
  "versionId": "complete-3.0"
}
